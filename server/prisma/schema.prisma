// Configuración básica
generator cliente {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- Modelos de Datos ---

model Usuario {
  id               String    @id @default(uuid())
  correo           String    @unique
  clave            String
  nombre           String?
  fechaCreacion    DateTime  @default(now())
  patrones         Patron[]  // Relación: Un usuario puede tener muchos patrones
  clientes         Cliente[]
}

model Cliente {
  id             String   @id @default(uuid())
  nombre         String?
  correo         String   @unique
  telefono       String   @unique
  notas          String?
  photoUri       String?  // Aquí guardaremos la ruta del archivo en el servidor
  totalPatrones  String?  @default("0")
  fechaCreacion  DateTime @default(now())

  // Relacion con la tabla Usuario
  usuario        Usuario  @relation(fields: [usuarioId], references: [id])
  usuarioId      String

  // Un cliente puede tener varios patrones
  patrones      Patron[]
}

model Patron {

  id                 String   @id @default(uuid())
  id_local           String   @unique

  nombre             String
  categoria          String   // Ej: "Caballero", "Dama"

  // En lugar de solo el nombre, usamos la relación
  cliente            Cliente? @relation(fields: [clienteId], references: [id])
  clienteId       String?
  
  // --- NUEVOS CAMPOS ---
  nombreCliente      String?  // "Sergio", "Altima"
  tipoPrenda         String?  // "playera_hombre"
  totalTela          Float?   // 0.35, 0.17
  dificultad         String?  // "Media", "Fácil"
  
  // Estructuras complejas (se guardan como Json)
  piezas             Json?    // Aquí va el array de objetos con los dibujos (d)
  instrucciones      Json?    // Aquí va el array de pasos ["Paso 1", "Paso 2"]
  estiloPrenda       Json?   
  
  // --- CAMPOS TÉCNICOS ---
  medidas            Json     // Se mantiene para las medidas de sisa, talle, etc.
  
  // Relaciones y Control
  usuario            Usuario  @relation(fields: [usuarioId], references: [id])
  usuarioId          String
  fechaCreacion      DateTime @default(now())
  fechaActualizacion DateTime @updatedAt
  fechaSincronizacion DateTime?

  @@unique([usuarioId, id_local])
}